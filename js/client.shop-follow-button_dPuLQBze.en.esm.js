import{d as e,q as o,aB as t,ax as n,_ as r,l,y as i,o as s,G as a,a0 as c,h as d,v as u,i as p,C as h,E as f,R as m,m as v,A as w,aD as g,g as N,Q as b,e as y,aE as O}from"./chunk.common_DH6hE_eH.esm.js";import{M as x,A as _}from"./chunk.modal_Coo4kjcu.esm.js";function k(e,o){return r(this,void 0,void 0,(function*(){try{const t=yield fetch(e,o);return"ok"in t&&!t.ok?null:function(e){return r(this,void 0,void 0,(function*(){try{return e&&"function"==typeof e.json?yield e.json():null}catch(e){return null}}))}(t)}catch(e){return null}}))}function F(o){var t;const{notify:n}=l(),[s,a]=e(null),[c,d]=e(!1);i((()=>{(()=>{r(this,void 0,void 0,(function*(){const e=yield function(){return r(this,arguments,void 0,(function*(e=location.origin){return k(`${e}/meta.json`)}))}(o);e?a(e):n(new Error("Failed to fetch store metadata")),d(!0)}))})()}),[n,o]);const u=null!==(t=null==s?void 0:s.name)&&void 0!==t?t:"the store";return{loaded:c,storeId:null==s?void 0:s.id,storeMetadata:s,storeName:u}}function L({anchorElement:e,devMode:o,onClose:t,storefrontOrigin:n}){var r;const{trackUserAction:l}=s(),{translate:i}=a(),{loaded:h,storeId:f,storeName:m}=F(n),v=f?`https://shop.app/sid/${f}`:"#";if(c()){const e=i("shopFollowButton.followingModal.title",{store:m}),o=i("shopFollowButton.followingModal.subtitle"),n=i("shopFollowButton.continueGeneric");return d(x,{headerLogo:d(u,{className:"h-4-5 text-purple-primary"}),onDismiss:t,popupDisabled:!0,variant:"follow",visible:h,children:d("div",{className:"m-auto p-6 font-sans",children:[d("div",{className:"relative m-auto pb-4 text-center",children:[d("h2",{className:"mb-2 px-6 text-subtitle text-black",children:e}),d("p",{className:"overflow-hidden text-ellipsis whitespace-pre-line text-body-small text-grayscale-d1",children:o})]}),d("div",{className:"flex justify-center",children:d("button",{className:"w-full rounded-md bg-purple-primary p-3 leading-6 text-white no-underline",onClick:function(){l({userAction:"FOLLOWING_GET_SHOP_APP_CLICK"}),p.open(v,"_self"),t()},type:"button",children:n})})]})})}const w=null!==(r=i("shopFollowButton.followingModal.qrAltText"))&&void 0!==r?r:"";let g=f?`https://shop.app/qr/sid/${f}`:"#";return o&&(g="https://shop.app/qr/sid/59659354134"),d(x,{anchorTo:e,disableMinWidth:!0,hideHeader:!0,onDismiss:t,popupDisabled:!0,variant:"follow",visible:h,children:d("div",{className:"m-auto w-55 p-6 font-sans",children:[d("div",{className:"relative m-auto pb-4 text-center",children:d("p",{className:"overflow-hidden text-ellipsis whitespace-pre-line text-grayscale-d1",children:i("shopFollowButton.followingModal.qrHeader",{store:m})})}),d("div",{className:"m-auto w-37 bg-white forced-color-adjust-none",children:d("img",{src:g,alt:w})}),d("div",{className:"flex justify-center px-0 pb-0 pt-4 text-purple-primary",children:d(u,{className:"h-5"})})]})})}function I({className:e,filled:o}){return d("svg",{className:e,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20",children:d("path",{fill:o?"currentColor":"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"1.667",d:"m9.14 4.502.86.881.86-.881a3.82 3.82 0 0 1 5.437-.064l.064.064c1.498 1.536 1.518 4.014.062 5.576l-.062.066L10 16.666l-6.36-6.524c-1.52-1.557-1.52-4.083 0-5.641a3.822 3.822 0 0 1 5.5 0Z"})})}const C=({clientId:c,devMode:p=!1,storefrontOrigin:h})=>{const{trackPageImpression:f,trackUserAction:m}=s(),{translate:x}=a(),k=v(),{notify:F}=l(),C=w(null),M=w(null),[E,S]=function({key:r,type:l="localStorage",defaultValue:i}){const s=`signInWithShop:${r}`,[a,c]=e((()=>{const e=n(s,{session:"sessionStorage"===l});if(!e)return i;try{return JSON.parse(e)}catch(e){return i}}));return[a,o((e=>{c(e),t(s,JSON.stringify(e),{session:"sessionStorage"===l})}),[s,l])]}({key:"following",defaultValue:!1}),[T,A]=e(!1),[B,P]=e(!1),D=g(h),[W,j]=e();i((()=>{f({page:E?"COMPONENT_LOADED_FOLLOWING":"COMPONENT_LOADED_NOT_FOLLOWING"})}),[E,f]),i((()=>{if(!C.current||void 0===f||!y())return;const e=new IntersectionObserver((o=>{for(const{isIntersecting:t}of o)t&&(null==e||e.disconnect(),f({page:"FOLLOW_BUTTON_SHOWN_IN_VIEWPORT"}))}));return e.observe(C.current),()=>{e.disconnect()}}),[f]);const G=o((()=>{var e;return E?(f({page:"FOLLOWING_GET_SHOP_APP_CTA"}),A(!0)):(m({userAction:"FOLLOW_ON_SHOP_CLICKED"}),p?S(!0):(P(!0),void(null===(e=M.current)||void 0===e||e.open("user_button_clicked"))))}),[p,E,S,f,m]);const H=N("absolute inset-y-0 -z-10 rounded-max bg-purple-primary",E?"w-9 animate-follow":"w-full group-hover_bg-purple-d0"),q=N("group relative inline-flex h-9 items-center rounded-max bg-transparent",E&&"gap-x-1-5"),z=N("cursor-pointer whitespace-nowrap pr-3 font-sans text-button-large transition-colors",E?"text-black":"text-white"),U=E?"shopFollowButton.following":"shopFollowButton.follow",{authorizeUrl:V}=b({clientId:c,error:W,flow:"follow",proxy:!0,redirectType:"iframe",responseType:"code"}),$=B?d(_,{onClose:()=>A(!1),onComplete:function(e){return r(this,arguments,void 0,(function*({loggedIn:e,shouldFinalizeLogin:o,email:t}){e&&o&&(yield O(D,(e=>{F(new Error(e))}))),k("completed",{loggedIn:e,email:t}),S(!0),P(!1),A(!1)}))},onError:function({code:e,email:o,message:t}){var n;k("error",{code:e,email:o,message:t}),"retriable_server_error"===e&&(W===e&&(null===(n=M.current)||void 0===n||n.reload()),j("retriable_server_error"))},onLoaded:function(){var e;!E&&B&&(null===(e=M.current)||void 0===e||e.open("user_button_clicked"))},proxy:!0,ref:M,src:V,storefrontOrigin:D,variant:"follow"}):null,R=E&&T&&D?d(L,{anchorElement:C,devMode:p,onClose:()=>A(!1),storefrontOrigin:D}):null;return d("div",{className:"relative z-0",children:[d("button",{className:q,onClick:G,type:"button",ref:C,children:[d("div",{className:H}),d("div",{className:"px-2 text-white",children:d(I,{className:"size-5",filled:E})}),d("span",{className:z,children:x(U,{shop:d(u,{className:"relative inline-block h-4 w-auto"})})})]}),$,R]})},M=e=>r(void 0,void 0,void 0,(function*(){return{shopFollowButton:{continueGeneric:"Continue",follow:"Follow on {shop}",following:"Following on {shop}",followingModal:{title:"Visit {store} on Shop",subtitle:"Everything you need to shop, track, and payâ€”all in one place.",qrHeader:"Scan to visit {store} on the Shop app",qrAltText:"Shop app QR code"}}}}));h((e=>{var{devMode:o,element:t}=e,n=f(e,["devMode","element"]);return d(m,{devMode:o,element:t,monorailProps:{analyticsContext:"loginWithShopFollow",flow:"follow"},featureName:"ShopFollowButton",getFeatureDictionary:M,children:d(C,Object.assign({},n,{devMode:o}))})}),{name:"shop-follow-button",props:{clientId:"string",devMode:"boolean",storefrontOrigin:"string"},shadow:"open"});
//# sourceMappingURL=client.shop-follow-button_dPuLQBze.en.esm.js.map
